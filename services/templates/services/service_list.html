{% extends 'services/base.html' %}
{% load static %}

{% block content %}
<h1>Browse Services</h1>

<!-- Search Form -->
<form method="get" action="{% url 'service_list' %}">
    <div>
        <label for="id_title">Title:</label>
        <input type="text" name="title" id="id_title" value="{{ form.title.value|default_if_none:'' }}">
    </div>
    <div>
        <label for="id_category">Category:</label>
        <select name="category" id="id_category">
            {% for choice in form.fields.category.choices %}
                <option value="{{ choice.0 }}" {% if choice.0 == form.category.value %}selected{% endif %}>
                    {{ choice.1 }}
                </option>
            {% endfor %}
        </select>
    </div>
    <div>
        <label for="id_min_price">Min Price:</label>
        <input type="number" step="0.01" name="min_price" id="id_min_price" value="{{ form.min_price.value|default_if_none:'' }}">
    </div>
    <div>
        <label for="id_max_price">Max Price:</label>
        <input type="number" step="0.01" name="max_price" id="id_max_price" value="{{ form.max_price.value|default_if_none:'' }}">
    </div>
    <button type="submit">Search</button>
</form>

<hr>

<!-- Service Results -->
{% if services %}
    <ul>
        {% for service in services %}
            <li>
                <h2>{{ service.title }}</h2>
                <p><strong>Category:</strong> {{ service.get_category_display }}</p>
                <p><strong>Price:</strong> ${{ service.price }}</p>
                <p><strong>Description:</strong> {{ service.description }}</p>
                <p><em>Posted on {{ service.created_at|date:"M d, Y" }}</em></p>
                
                {% if not service.is_paid %}
                    <a href="{% url 'process_payment' service.pk %}" class="btn btn-primary">Pay Now</a>
                {% else %}
                    <span class="text-success">Paid</span>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
{% else %}
    <p>No services found matching your criteria.</p>
{% endif %}
{% endblock %}
